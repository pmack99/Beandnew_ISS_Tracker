<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Anton|Josefin+Sans|Questrial" rel="stylesheet">
  <!--firebase-->
  <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
    crossorigin="" />
  <!-- leaflet scriptfiles -->
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
    crossorigin=""></script>
  <!--Link the javascript files this is for the moment time thingy-->
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

  <title>PMack ISS Tracker</title>
  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/scrolling-nav.css" rel="stylesheet">

  <!-- <link rel="stylesheet" type="text/css" href="css/reset.css"> -->
  <link rel="stylesheet" type="text/css" href="css/style.css">

</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <div class="container-fluid">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">ISS Tracker</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#map">Map</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#pass">Pass</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#apod">Photos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#contact">About</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="top">
    <div class="container-fluid text-center">
        <img src="images/3.jpg" class="image" id="iss" />
        <div class="centered"> <h1>International Space Station Tracker</h1> </div>
      
          </div>
        
    </div>
  </header>


  <!-- Map -->
  <section id="map">

    <div class="container-fluid">
      <div class="jumbotron">
        <div class="row mx-auto" id="mapBox">
          <!-- <h1 class="headline">International Space Station Tracker</h1> -->
          <div class="col-9" id="mapId"></div>
          <div class="col-3" id="issInfo">
            <br>
            <div id="latitudeN"> </div>
            <div id="longitudeN"> </div>
            <hr>
            <div id="altitude"> </div>
            <div id="velocity"> </div>
            <hr>
            <div id="solar_latN"></div>
            <div id="solar_lonN"></div>
            <hr>
            <div id="visibility"> </div>
          </div>

        </div>
      </div>
    </div>
    </div>

  </section>


  <!-- ISS Pass -->
  <section id="pass">

    <div class="container-fluid">
      <div class="jumbotron">
        <div class="row mx-auto">
            <div class="col-6" id="passBox">
          <h2>ISS Overhead Pass Data</h2>
          <div class="input-group mb-3">
            <div class="input-group-prepend ">
              <button class="button btn-warning" type="button" id="button-addon1">Enter City</button>
            </div>
            <input type="text" class="form-control col-md-3 " placeholder="Example - Orlando, FL">
          </div>
          <div class="scrollit">
            <table class="table">
              <div id="tableScroll">
                <thead>
                  <tr>
                    <th scope="col">City</th>
                    <th scope="col">ISS Pass</th>
                    <th scope="col">Duration</th>
                    <th scope="col">Appears</th>
                    <th scope="col">Start Elevation</th>
                    <th scope="col">Max Elevation</th>
                    <th scope="col">Departs</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td></td>

                  </tr>
                </tbody>
              </div>
            </table>

          </div>
          </div>

          <div class="col-6 mx-auto apod" id="apod">
              <h2>Images of the ISS</h2>
            
            <div id="apod1">
              
  
            </div>
            <div id="apod2" >
              
              <div class="caption text"></div>
            </div>
          </div>
  
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- APOD -->

  <!-- <section id="apod">

    <div class="container-fluid">
      <div class="jumbotron">
        <div class="row apod">
          <div class="col-6 mx-auto" id="apodText">
            <h2>Images of the ISS from the NASA Image Archive</h2>
          </div>
          <div class="row img">
            <div class="col-12 img" id="apod1"> </div>

          </div>
          <div class="row">
            <div class="col-12" id="apod2"> </div>
            <div class="caption text"></div>
          </div>

        </div>
      </div>
    </div>

    </div>

  </section> -->

  <!-- Contact -->
  <section id="contact">
    <div class="container-fluid">
      <div class="jumbotron">
        <div class="row">
          <div class="col mx-auto">
            <h2>ABOUT THIS PROJECT </h2>
            <p class="lead">
              My name is Preston Mack. I am currently enrolled in the University of Central Florida's Coding Bootcamp.
              The first group project required us to develop an app that utilized multiple APIs. The "ISS Tracker" was
              the result. For this version, I rewrote much of the code, stripping away extraneous features (like
              Firebase) and I changed the API used for the ISS passovers. Thanks to my wonderful class partners Sarah
              Sefcik, Jennifer Gibson and Christine Deer.
            </p>
            <h2> ABOUT THIS SITE </h2>
            <p class="lead1"> I utilized the "wheretheiss.at API" for the ISS location. Leaflet was integrated with the Mapbox API to
              generate the realtime map. This application utilizes a Mapquest API for the reverse geocode. Once the
              coordinates are obtained, that data is passed into the "N2YO.COM REST API" to parse the ISS pass
              information. Finally, the NASA Image Archive API was used to obtain the photos and captions.</p>
          </div>
        </div>
      </div>
    </div>
  </section>



  <script type="text/javascript">


    // Initialize Firebase
    var config = {
    apiKey: "AIzaSyAw8TqiPOkzzTlB1rIEbT4sE_yGRk-qq4k",
    authDomain: "space-force-iss.firebaseapp.com",
    databaseURL: "https://space-force-iss.firebaseio.com",
    projectId: "space-force-iss",
    storageBucket: "space-force-iss.appspot.com",
    messagingSenderId: "170025590751"
  };
  firebase.initializeApp(config);
  var database = firebase.database();

    var latitude = "";
    var longitude = "";
    var altitude = "";
    var velocity = "";
    var solar_lat = "";
    var solar_lon = "";
    var mymap = null;


    function moveIss() {
      if (mymap !== null) mymap.remove();

      var queryURL = "https://www.n2yo.com/rest/v1/satellite/positions/25544/41.702/-76.014/0/2/&apiKey=LDUFJ6-J5J7F4-DCMYRA-3WB7"

      $.ajax({
        url: queryURL,
        method: "GET"
      })
        .then(function (response) {
          console.log(response);

          console.log(response.positions[0].satlatitude);
          console.log(response.positions[0].satlongitude);
          console.log(response.positions[0].ra);
          console.log(response.positions[0].dec);

        //   var altitude = response.altitude;
        //   var velocity = response.velocity;
        //   var visibility = response.visibility;
          var latitude = response.positions[0].satlatitude;
          var longitude = response.positions[0].satlongitude;
          var ra = response.positions[0].ra;
          var dec = response.positions[0].dec;
          var time = response.positions[0].timestamp;
          var timestamp = moment.unix(time).format('LLLL');
                console.log(timestamp);

        //   var solar_lat = response.solar_lat;
        //   var solar_lon = response.solar_lon;

        //   var altitudeN = altitude.toFixed(2);
        //   var velocityN = velocity.toFixed(2);
        //   var latitudeN = latitude.toFixed(4);
        //   var longitudeN = longitude.toFixed(4);
        //   var solar_latN = solar_lat.toFixed(4);
        //   var solar_lonN = solar_lon.toFixed(4);

          $("#latitudeN").text("Latitude: " + latitude),
          $("#longitudeN").text("Longitude: " + longitude),
          $("#altitude").text("Satellite right angle:  " + ra ),
          $("#velocity").text("Sattellite Declination:  " + dec );
          $("#solar_latN").text(timestamp);
        //   $("#solar_lonN").text("Solar Longitude: " + solar_lonN);
        //   $("#visibility").text("Visibility: " + visibility);

          mymap = L.map("mapId").setView([latitude, longitude], 4);

          var issIcon = L.icon({
            iconUrl: "images/iss2.png",

            iconSize: [35, 44], // size of the icon

          });

          L.tileLayer(
            "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",
            {
              attribution:
                'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
              maxZoom: 14,
              id: "mapbox.streets",
              accessToken:
                "pk.eyJ1IjoicG1hY2s5OSIsImEiOiJjam1zNXh4c2owMGc5M3dwN2ZjeWloc2t5In0.OJ_GGAfAJgMK0OCnN2NbhA"
            }
          ).addTo(mymap);

          L.marker([latitude, longitude], { icon: issIcon }).addTo(mymap);

        });
      setTimeout(moveIss, 27000);



    }

    moveIss();


    var time = 0;
    var duration = 0;
    var whereStart = [];
    var whereEnd = [];
    var howHigh = 0;
    var maxHigh = 0;
    var startEl = 0;
    var maxEl = 0;
    var passcount = 0;
    var userInput = 0;
    var cityState = 0;
    var apiKeyMapquest = 0;
    var caption = [];

    $(".button").on("click", function (event) {

      event.preventDefault();
      //$("tbody").empty(" ");

      // var apiKeyMapquest = "VhIG9vrD4t2JMvh5f9k61v8rcGERpvxV";
      var apiKeyMapquest = "ua7RUmNymQq5oRMabONKpUlrpGpV3M6s";
      var userInput = $("input").val();
      var cityState = userInput.trim();
      console.log(cityState);

      var queryUrl =
        "https://www.mapquestapi.com/geocoding/v1/address?key=" +
        apiKeyMapquest +
        "&location=" +
        cityState;
      console.log(queryUrl);

      $.ajax({
        url: queryUrl,
        method: "GET"
      }).then(function (response) {
        var results = response.results;
        console.log(results);

        var lat = results[0].locations[0].displayLatLng.lat;
        var lon = results[0].locations[0].displayLatLng.lng;
        database.ref().push(lat);
        database.ref().push(lon);

        var queryURL = "https://www.n2yo.com/rest/v1/satellite/visualpasses/25544/" + lat + "/" + lon + "/0/2/300/&apiKey=LDUFJ6-J5J7F4-DCMYRA-3WB7"

        console.log(queryURL);


        // Performing our AJAX GET request
        $.ajax({
          url: queryURL,
          method: "GET"
        })
          // After the data comes back from the API
          .then(function (response) {
            console.log(response);

            var passesCount = response.info.passescount;
            console.log(passesCount)
            if (passesCount == 0) {
              var newRow = $("<tr>").append(
                $("<td>").text("There are no visible passes in the next 10 days"),
                  database.ref().push("there are no visible passes in the next 10 days in " + cityState)

              );

              $("tbody").append(newRow);

            } else {
              // Storing an array of results in the results variable
              for (var i = 0; i < response.passes.length; i++) {
                var time = response.passes[i].startUTC;


                var dateString = moment.unix(time).format('LLLL');
                console.log(dateString);

                var duration = response.passes[i].duration;
                console.log("Duration= " + duration + " seconds");

                var whereStart = response.passes[i].startAzCompass
                console.log("ISS appears from the " + whereStart);

                var howHigh = response.passes[i].startEl
                console.log("Starting Elevation = " + howHigh);

                var maxHigh = response.passes[i].maxEl
                console.log("Maximum Elevation = " + maxHigh);

                var whereEnd = response.passes[i].endAzCompass
                console.log("ISS disappears to the " + whereEnd);

                var newSearch ={
                  search: cityState,
                  date: dateString,
                  lengthOfTime: "Duration= " + duration + " seconds",
                  start: "ISS appears from the " + whereStart,
                  startingElevation:"Starting Elevation = " + howHigh,
                  maxElevation:"Maximum Elevation = " + maxHigh,
                  end: "ISS disappears to the " + whereEnd
                }

                database.ref().push(newSearch);

                var newRow = $("<tr>").append(

                  $("<td>").text(cityState),
                  $("<td>").text(dateString),
                  $("<td>").text(duration),
                  $("<td>").text(whereStart),
                  $("<td>").text(howHigh),
                  $("<td>").text(maxHigh),
                  $("<td>").text(whereEnd)
                );

                $("tbody").prepend(newRow);





              }
            }

          })

      });
    });

    var i = 0;
    var queryURL = "https://images-api.nasa.gov/search?q=iss&media_type=image"

    $.ajax({
      url: queryURL,
      method: "GET"
    })

      .then(function (response) {
        console.log(response);

        function issImages() {

          $("#apod1 img").remove();
          $(".caption").html(" ");

          i = Math.floor(Math.random() * 99 + 1);
          console.log(i);

          var apod = response.collection.items[i].links[0].href;
          var image = $("<img>").attr("src", apod).attr("class", "img").attr("class", "img-fluid").attr("alt", "Responsive image").attr("class", "float-right").attr("class", "rounded");
          var caption = response.collection.items[i].data[0].description;


          $("#apod1").append(image);
          $(".caption").append(caption);

          setTimeout(issImages, 30000);

        }

        issImages();


      });




  </script>







  <!-- Optional JavaScript -->
<!--Firebase Script tag-->
<!-- <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom JavaScript for this theme -->
  <script src="js/scrolling-nav.js"></script>
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

</body>

</html>